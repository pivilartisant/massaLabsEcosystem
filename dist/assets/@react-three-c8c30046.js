import{_ as we}from"./@babel-34ca84e8.js";import{r as T}from"./react-04e5617c.js";import{L as ce,T as Ye,R as Ke,U as Je,s as xe,B as Qe,M as Ze,C as et,a as tt,O as nt,P as rt,S as Pe,b as fe,W as ot,c as it,d as st,e as at,V as lt,f as ct,N as ft,A as ut,g as ee,h as dt,i as pt,j as vt}from"./three-7873497c.js";import{u as mt}from"./react-use-measure-19de349e.js";import{F as ht,u as gt}from"./its-fine-873af5a6.js";import{R as _t,c as X}from"./react-reconciler-9b4c502a.js";import"./react-dom-fd668070.js";import"./maath-4ed993c7.js";import"./@react-spring-dc6bc5fd.js";import"./lodash.pick-4ed993c7.js";import{G as Ce,D as yt,M as ue,O as bt}from"./three-stdlib-61ce261d.js";import{c as wt}from"./zustand-bab0857b.js";import{s as Ct,p as Et,c as Pt}from"./suspend-react-00b64780.js";import"./lodash.omit-4ed993c7.js";import"./stats.js-4ed993c7.js";import"./react-composer-dc6bc5fd.js";var ae={},Mt={get exports(){return ae},set exports(e){ae=e}},Ae={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(g,M){var P=g.length;g.push(M);e:for(;0<P;){var O=P-1>>>1,k=g[O];if(0<u(k,M))g[O]=M,g[P]=k,P=O;else break e}}function o(g){return g.length===0?null:g[0]}function i(g){if(g.length===0)return null;var M=g[0],P=g.pop();if(P!==M){g[0]=P;e:for(var O=0,k=g.length,B=k>>>1;O<B;){var L=2*(O+1)-1,K=g[L],H=L+1,re=g[H];if(0>u(K,P))H<k&&0>u(re,K)?(g[O]=re,g[H]=P,O=H):(g[O]=K,g[L]=P,O=L);else if(H<k&&0>u(re,P))g[O]=re,g[H]=P,O=H;else break e}}return M}function u(g,M){var P=g.sortIndex-M.sortIndex;return P!==0?P:g.id-M.id}if(typeof performance=="object"&&typeof performance.now=="function"){var p=performance;e.unstable_now=function(){return p.now()}}else{var E=Date,_=E.now();e.unstable_now=function(){return E.now()-_}}var s=[],m=[],n=1,r=null,c=3,f=!1,d=!1,b=!1,h=typeof setTimeout=="function"?setTimeout:null,a=typeof clearTimeout=="function"?clearTimeout:null,l=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(g){for(var M=o(m);M!==null;){if(M.callback===null)i(m);else if(M.startTime<=g)i(m),M.sortIndex=M.expirationTime,t(s,M);else break;M=o(m)}}function y(g){if(b=!1,v(g),!d)if(o(s)!==null)d=!0,N(w);else{var M=o(m);M!==null&&z(y,M.startTime-g)}}function w(g,M){d=!1,b&&(b=!1,a(R),R=-1),f=!0;var P=c;try{for(v(M),r=o(s);r!==null&&(!(r.expirationTime>M)||g&&!C());){var O=r.callback;if(typeof O=="function"){r.callback=null,c=r.priorityLevel;var k=O(r.expirationTime<=M);M=e.unstable_now(),typeof k=="function"?r.callback=k:r===o(s)&&i(s),v(M)}else i(s);r=o(s)}if(r!==null)var B=!0;else{var L=o(m);L!==null&&z(y,L.startTime-M),B=!1}return B}finally{r=null,c=P,f=!1}}var S=!1,x=null,R=-1,I=5,A=-1;function C(){return!(e.unstable_now()-A<I)}function j(){if(x!==null){var g=e.unstable_now();A=g;var M=!0;try{M=x(!0,g)}finally{M?F():(S=!1,x=null)}}else S=!1}var F;if(typeof l=="function")F=function(){l(j)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,G=U.port2;U.port1.onmessage=j,F=function(){G.postMessage(null)}}else F=function(){h(j,0)};function N(g){x=g,S||(S=!0,F())}function z(g,M){R=h(function(){g(e.unstable_now())},M)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(g){g.callback=null},e.unstable_continueExecution=function(){d||f||(d=!0,N(w))},e.unstable_forceFrameRate=function(g){0>g||125<g?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<g?Math.floor(1e3/g):5},e.unstable_getCurrentPriorityLevel=function(){return c},e.unstable_getFirstCallbackNode=function(){return o(s)},e.unstable_next=function(g){switch(c){case 1:case 2:case 3:var M=3;break;default:M=c}var P=c;c=M;try{return g()}finally{c=P}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(g,M){switch(g){case 1:case 2:case 3:case 4:case 5:break;default:g=3}var P=c;c=g;try{return M()}finally{c=P}},e.unstable_scheduleCallback=function(g,M,P){var O=e.unstable_now();switch(typeof P=="object"&&P!==null?(P=P.delay,P=typeof P=="number"&&0<P?O+P:O):P=O,g){case 1:var k=-1;break;case 2:k=250;break;case 5:k=1073741823;break;case 4:k=1e4;break;default:k=5e3}return k=P+k,g={id:n++,callback:M,priorityLevel:g,startTime:P,expirationTime:k,sortIndex:-1},P>O?(g.sortIndex=P,t(m,g),o(s)===null&&g===o(m)&&(b?(a(R),R=-1):b=!0,z(y,P-O))):(g.sortIndex=k,t(s,g),d||f||(d=!0,N(w))),g},e.unstable_shouldYield=C,e.unstable_wrapCallback=function(g){var M=c;return function(){var P=c;c=M;try{return g.apply(this,arguments)}finally{c=P}}}})(Ae);(function(e){e.exports=Ae})(Mt);const Ee={},St=e=>void Object.assign(Ee,e);function Ot(e,t){function o(n,{args:r=[],attach:c,...f},d){let b=`${n[0].toUpperCase()}${n.slice(1)}`,h;if(n==="primitive"){if(f.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const a=f.object;h=W(a,{type:n,root:d,attach:c,primitive:!0})}else{const a=Ee[b];if(!a)throw new Error(`R3F: ${b} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");h=W(new a(...r),{type:n,root:d,attach:c,memoizedProps:{args:r}})}return h.__r3f.attach===void 0&&(h instanceof Qe?h.__r3f.attach="geometry":h instanceof Ze&&(h.__r3f.attach="material")),b!=="inject"&&pe(h,f),h}function i(n,r){let c=!1;if(r){var f,d;(f=r.__r3f)!=null&&f.attach?de(n,r,r.__r3f.attach):r.isObject3D&&n.isObject3D&&(n.add(r),c=!0),c||(d=n.__r3f)==null||d.objects.push(r),r.__r3f||W(r,{}),r.__r3f.parent=n,be(r),V(r)}}function u(n,r,c){let f=!1;if(r){var d,b;if((d=r.__r3f)!=null&&d.attach)de(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){r.parent=n,r.dispatchEvent({type:"added"});const h=n.children.filter(l=>l!==r),a=h.indexOf(c);n.children=[...h.slice(0,a),r,...h.slice(a)],f=!0}f||(b=n.__r3f)==null||b.objects.push(r),r.__r3f||W(r,{}),r.__r3f.parent=n,be(r),V(r)}}function p(n,r,c=!1){n&&[...n].forEach(f=>E(r,f,c))}function E(n,r,c){if(r){var f,d,b;if(r.__r3f&&(r.__r3f.parent=null),(f=n.__r3f)!=null&&f.objects&&(n.__r3f.objects=n.__r3f.objects.filter(y=>y!==r)),(d=r.__r3f)!=null&&d.attach)Te(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){var h;n.remove(r),(h=r.__r3f)!=null&&h.root&&Lt(r.__r3f.root,r)}const l=(b=r.__r3f)==null?void 0:b.primitive,v=c===void 0?r.dispose!==null&&!l:c;if(!l){var a;p((a=r.__r3f)==null?void 0:a.objects,r,v),p(r.children,r,v)}r.__r3f&&(delete r.__r3f.root,delete r.__r3f.objects,delete r.__r3f.handlers,delete r.__r3f.memoizedProps,l||delete r.__r3f),v&&r.dispose&&r.type!=="Scene"&&ae.unstable_scheduleCallback(ae.unstable_IdlePriority,()=>{try{r.dispose()}catch{}}),V(n)}}function _(n,r,c,f){var d;const b=(d=n.__r3f)==null?void 0:d.parent;if(!b)return;const h=o(r,c,n.__r3f.root);if(n.children){for(const a of n.children)a.__r3f&&i(h,a);n.children=n.children.filter(a=>!a.__r3f)}n.__r3f.objects.forEach(a=>i(h,a)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||E(b,n),h.parent&&(h.__r3f.autoRemovedBeforeAppend=!0),i(b,h),h.raycast&&h.__r3f.eventCount&&h.__r3f.root.getState().internal.interaction.push(h),[f,f.alternate].forEach(a=>{a!==null&&(a.stateNode=h,a.ref&&(typeof a.ref=="function"?a.ref(h):a.ref.current=h))})}const s=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:_t({createInstance:o,removeChild:E,appendChild:i,appendInitialChild:i,insertBefore:u,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,r)=>{if(!r)return;const c=n.getState().scene;c.__r3f&&(c.__r3f.root=n,i(c,r))},removeChildFromContainer:(n,r)=>{r&&E(n.getState().scene,r)},insertInContainerBefore:(n,r,c)=>{if(!r||!c)return;const f=n.getState().scene;f.__r3f&&u(f,r,c)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var r;const c=(r=n==null?void 0:n.__r3f)!=null?r:{};return Boolean(c.handlers)},prepareUpdate(n,r,c,f){if(n.__r3f.primitive&&f.object&&f.object!==n)return[!0];{const{args:d=[],children:b,...h}=f,{args:a=[],children:l,...v}=c;if(!Array.isArray(d))throw new Error("R3F: the args prop must be an array!");if(d.some((w,S)=>w!==a[S]))return[!0];const y=He(n,h,v,!0);return y.changes.length?[!1,y]:null}},commitUpdate(n,[r,c],f,d,b,h){r?_(n,f,b,h):pe(n,c)},commitMount(n,r,c,f){var d;const b=(d=n.__r3f)!=null?d:{};n.raycast&&b.handlers&&b.eventCount&&n.__r3f.root.getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>W(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var r;const{attach:c,parent:f}=(r=n.__r3f)!=null?r:{};c&&f&&Te(f,n,c),n.isObject3D&&(n.visible=!1),V(n)},unhideInstance(n,r){var c;const{attach:f,parent:d}=(c=n.__r3f)!=null?c:{};f&&d&&de(d,n,f),(n.isObject3D&&r.visible==null||r.visible)&&(n.visible=!0),V(n)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():X.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&D.fun(performance.now)?performance.now:D.fun(Date.now)?Date.now:()=>0,scheduleTimeout:D.fun(setTimeout)?setTimeout:void 0,cancelTimeout:D.fun(clearTimeout)?clearTimeout:void 0}),applyProps:pe}}var Me,Se;const De=()=>{var e;return(e=Ee.ColorManagement)!=null?e:null},Le=e=>e&&e.isOrthographicCamera,kt=e=>e&&e.hasOwnProperty("current"),te=typeof window<"u"&&((Me=window.document)!=null&&Me.createElement||((Se=window.navigator)==null?void 0:Se.product)==="ReactNative")?T.useLayoutEffect:T.useEffect;function Ie(e){const t=T.useRef(e);return te(()=>void(t.current=e),[e]),t}function Tt({set:e}){return te(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Fe extends T.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}Fe.getDerivedStateFromError=()=>({error:!0});const ze="__default",Oe=new Map,jt=e=>e&&!!e.memoized&&!!e.changes;function Be(e){const t=typeof window<"u"?window.devicePixelRatio:1;return Array.isArray(e)?Math.min(Math.max(e[0],t),e[1]):e}const J=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},D={obj:e=>e===Object(e)&&!D.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:o="shallow",objects:i="reference",strict:u=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(D.str(e)||D.num(e))return e===t;const p=D.obj(e);if(p&&i==="reference")return e===t;const E=D.arr(e);if(E&&o==="reference")return e===t;if((E||p)&&e===t)return!0;let _;for(_ in e)if(!(_ in t))return!1;if(p&&o==="shallow"&&i==="shallow"){for(_ in u?t:e)if(!D.equ(e[_],t[_],{strict:u,objects:"reference"}))return!1}else for(_ in u?t:e)if(e[_]!==t[_])return!1;if(D.und(_)){if(E&&e.length===0&&t.length===0||p&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Rt(e){const t={nodes:{},materials:{}};return e&&e.traverse(o=>{o.name&&(t.nodes[o.name]=o),o.material&&!t.materials[o.material.name]&&(t.materials[o.material.name]=o.material)}),t}function xt(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function W(e,t){const o=e;return(t!=null&&t.primitive||!o.__r3f)&&(o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t}),e}function ye(e,t){let o=e;if(t.includes("-")){const i=t.split("-"),u=i.pop();return o=i.reduce((p,E)=>p[E],e),{target:o,key:u}}else return{target:o,key:t}}const ke=/-\d+$/;function de(e,t,o){if(D.str(o)){if(ke.test(o)){const p=o.replace(ke,""),{target:E,key:_}=ye(e,p);Array.isArray(E[_])||(E[_]=[])}const{target:i,key:u}=ye(e,o);t.__r3f.previousAttach=i[u],i[u]=t}else t.__r3f.previousAttach=o(e,t)}function Te(e,t,o){var i,u;if(D.str(o)){const{target:p,key:E}=ye(e,o),_=t.__r3f.previousAttach;_===void 0?delete p[E]:p[E]=_}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(u=t.__r3f)==null||delete u.previousAttach}function He(e,{children:t,key:o,ref:i,...u},{children:p,key:E,ref:_,...s}={},m=!1){var n;const r=(n=e==null?void 0:e.__r3f)!=null?n:{},c=Object.entries(u),f=[];if(m){const b=Object.keys(s);for(let h=0;h<b.length;h++)u.hasOwnProperty(b[h])||c.unshift([b[h],ze+"remove"])}c.forEach(([b,h])=>{var a;if((a=e.__r3f)!=null&&a.primitive&&b==="object"||D.equ(h,s[b]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(b))return f.push([b,h,!0,[]]);let l=[];b.includes("-")&&(l=b.split("-")),f.push([b,h,!1,l]);for(const v in u){const y=u[v];v.startsWith(`${b}-`)&&f.push([v,y,!1,v.split("-")])}});const d={...u};return r.memoizedProps&&r.memoizedProps.args&&(d.args=r.memoizedProps.args),r.memoizedProps&&r.memoizedProps.attach&&(d.attach=r.memoizedProps.attach),{memoized:d,changes:f}}function pe(e,t){var o,i,u;const p=(o=e.__r3f)!=null?o:{},E=p.root,_=(i=E==null||E.getState==null?void 0:E.getState())!=null?i:{},{memoized:s,changes:m}=jt(t)?t:He(e,t),n=p.eventCount;e.__r3f&&(e.__r3f.memoizedProps=s);for(let c=0;c<m.length;c++){let[f,d,b,h]=m[c],a=e,l=a[f];if(h.length&&(l=h.reduce((v,y)=>v[y],e),!(l&&l.set))){const[v,...y]=h.reverse();a=y.reverse().reduce((w,S)=>w[S],e),f=v}if(d===ze+"remove")if(a.constructor){let v=Oe.get(a.constructor);v||(v=new a.constructor,Oe.set(a.constructor,v)),d=v[f]}else d=0;if(b)d?p.handlers[f]=d:delete p.handlers[f],p.eventCount=Object.keys(p.handlers).length;else if(l&&l.set&&(l.copy||l instanceof ce)){if(Array.isArray(d))l.fromArray?l.fromArray(d):l.set(...d);else if(l.copy&&d&&d.constructor&&l.constructor===d.constructor)l.copy(d);else if(d!==void 0){const v=l instanceof et;!v&&l.setScalar?l.setScalar(d):l instanceof ce&&d instanceof ce?l.mask=d.mask:l.set(d),!De()&&!_.linear&&v&&l.convertSRGBToLinear()}}else a[f]=d,!_.linear&&a[f]instanceof Ye&&a[f].format===Ke&&a[f].type===Je&&(a[f].encoding=xe);V(e)}if(p.parent&&_.internal&&e.raycast&&n!==p.eventCount){const c=_.internal.interaction.indexOf(e);c>-1&&_.internal.interaction.splice(c,1),p.eventCount&&_.internal.interaction.push(e)}return!(m.length===1&&m[0][0]==="onUpdate")&&m.length&&(u=e.__r3f)!=null&&u.parent&&be(e),e}function V(e){var t,o;const i=(t=e.__r3f)==null||(o=t.root)==null||o.getState==null?void 0:o.getState();i&&i.internal.frames===0&&i.invalidate()}function be(e){e.onUpdate==null||e.onUpdate(e)}function At(e,t){e.manual||(Le(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function oe(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Dt(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return X.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return X.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return X.ContinuousEventPriority;default:return X.DefaultEventPriority}}function Ne(e,t,o,i){const u=o.get(t);u&&(o.delete(t),o.size===0&&(e.delete(i),u.target.releasePointerCapture(i)))}function Lt(e,t){const{internal:o}=e.getState();o.interaction=o.interaction.filter(i=>i!==t),o.initialHits=o.initialHits.filter(i=>i!==t),o.hovered.forEach((i,u)=>{(i.eventObject===t||i.object===t)&&o.hovered.delete(u)}),o.capturedMap.forEach((i,u)=>{Ne(o.capturedMap,t,i,u)})}function It(e){function t(s){const{internal:m}=e.getState(),n=s.offsetX-m.initialClick[0],r=s.offsetY-m.initialClick[1];return Math.round(Math.sqrt(n*n+r*r))}function o(s){return s.filter(m=>["Move","Over","Enter","Out","Leave"].some(n=>{var r;return(r=m.__r3f)==null?void 0:r.handlers["onPointer"+n]}))}function i(s,m){const n=e.getState(),r=new Set,c=[],f=m?m(n.internal.interaction):n.internal.interaction;for(let a=0;a<f.length;a++){const l=J(f[a]);l&&(l.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(s,n);function d(a){const l=J(a);if(!l||!l.events.enabled||l.raycaster.camera===null)return[];if(l.raycaster.camera===void 0){var v;l.events.compute==null||l.events.compute(s,l,(v=l.previousRoot)==null?void 0:v.getState()),l.raycaster.camera===void 0&&(l.raycaster.camera=null)}return l.raycaster.camera?l.raycaster.intersectObject(a,!0):[]}let b=f.flatMap(d).sort((a,l)=>{const v=J(a.object),y=J(l.object);return!v||!y?a.distance-l.distance:y.events.priority-v.events.priority||a.distance-l.distance}).filter(a=>{const l=oe(a);return r.has(l)?!1:(r.add(l),!0)});n.events.filter&&(b=n.events.filter(b,n));for(const a of b){let l=a.object;for(;l;){var h;(h=l.__r3f)!=null&&h.eventCount&&c.push({...a,eventObject:l}),l=l.parent}}if("pointerId"in s&&n.internal.capturedMap.has(s.pointerId))for(let a of n.internal.capturedMap.get(s.pointerId).values())r.has(oe(a.intersection))||c.push(a.intersection);return c}function u(s,m,n,r){const c=e.getState();if(s.length){const f={stopped:!1};for(const d of s){const b=J(d.object)||c,{raycaster:h,pointer:a,camera:l,internal:v}=b,y=new ee(a.x,a.y,0).unproject(l),w=A=>{var C,j;return(C=(j=v.capturedMap.get(A))==null?void 0:j.has(d.eventObject))!=null?C:!1},S=A=>{const C={intersection:d,target:m.target};v.capturedMap.has(A)?v.capturedMap.get(A).set(d.eventObject,C):v.capturedMap.set(A,new Map([[d.eventObject,C]])),m.target.setPointerCapture(A)},x=A=>{const C=v.capturedMap.get(A);C&&Ne(v.capturedMap,d.eventObject,C,A)};let R={};for(let A in m){let C=m[A];typeof C!="function"&&(R[A]=C)}let I={...d,...R,pointer:a,intersections:s,stopped:f.stopped,delta:n,unprojectedPoint:y,ray:h.ray,camera:l,stopPropagation(){const A="pointerId"in m&&v.capturedMap.get(m.pointerId);if((!A||A.has(d.eventObject))&&(I.stopped=f.stopped=!0,v.hovered.size&&Array.from(v.hovered.values()).find(C=>C.eventObject===d.eventObject))){const C=s.slice(0,s.indexOf(d));p([...C,d])}},target:{hasPointerCapture:w,setPointerCapture:S,releasePointerCapture:x},currentTarget:{hasPointerCapture:w,setPointerCapture:S,releasePointerCapture:x},nativeEvent:m};if(r(I),f.stopped===!0)break}}return s}function p(s){const{internal:m}=e.getState();for(const n of m.hovered.values())if(!s.length||!s.find(r=>r.object===n.object&&r.index===n.index&&r.instanceId===n.instanceId)){const c=n.eventObject.__r3f,f=c==null?void 0:c.handlers;if(m.hovered.delete(oe(n)),c!=null&&c.eventCount){const d={...n,intersections:s};f.onPointerOut==null||f.onPointerOut(d),f.onPointerLeave==null||f.onPointerLeave(d)}}}function E(s,m){for(let n=0;n<m.length;n++){const r=m[n].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(s)}}function _(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>p([]);case"onLostPointerCapture":return m=>{const{internal:n}=e.getState();"pointerId"in m&&n.capturedMap.has(m.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(m.pointerId)&&(n.capturedMap.delete(m.pointerId),p([]))})}}return function(n){const{onPointerMissed:r,internal:c}=e.getState();c.lastEvent.current=n;const f=s==="onPointerMove",d=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",h=i(n,f?o:void 0),a=d?t(n):0;s==="onPointerDown"&&(c.initialClick=[n.offsetX,n.offsetY],c.initialHits=h.map(v=>v.eventObject)),d&&!h.length&&a<=2&&(E(n,c.interaction),r&&r(n)),f&&p(h);function l(v){const y=v.eventObject,w=y.__r3f,S=w==null?void 0:w.handlers;if(w!=null&&w.eventCount)if(f){if(S.onPointerOver||S.onPointerEnter||S.onPointerOut||S.onPointerLeave){const x=oe(v),R=c.hovered.get(x);R?R.stopped&&v.stopPropagation():(c.hovered.set(x,v),S.onPointerOver==null||S.onPointerOver(v),S.onPointerEnter==null||S.onPointerEnter(v))}S.onPointerMove==null||S.onPointerMove(v)}else{const x=S[s];x?(!d||c.initialHits.includes(y))&&(E(n,c.interaction.filter(R=>!c.initialHits.includes(R))),x(v)):d&&c.initialHits.includes(y)&&E(n,c.interaction.filter(R=>!c.initialHits.includes(R)))}}u(h,n,a,l)}}return{handlePointer:_}}const qe=e=>!!(e!=null&&e.render),Ue=T.createContext(null),Ft=(e,t)=>{const o=wt((_,s)=>{const m=new ee,n=new ee,r=new ee;function c(a=s().camera,l=n,v=s().size){const{width:y,height:w,top:S,left:x}=v,R=y/w;l instanceof ee?r.copy(l):r.set(...l);const I=a.getWorldPosition(m).distanceTo(r);if(Le(a))return{width:y/a.zoom,height:w/a.zoom,top:S,left:x,factor:1,distance:I,aspect:R};{const A=a.fov*Math.PI/180,C=2*Math.tan(A/2)*I,j=C*(y/w);return{width:j,height:C,top:S,left:x,factor:y/j,distance:I,aspect:R}}}let f;const d=a=>_(l=>({performance:{...l.performance,current:a}})),b=new dt;return{set:_,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(a=1)=>e(s(),a),advance:(a,l)=>t(a,l,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new pt,pointer:b,mouse:b,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const a=s();f&&clearTimeout(f),a.performance.current!==a.performance.min&&d(a.performance.min),f=setTimeout(()=>d(s().performance.max),a.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:c},setEvents:a=>_(l=>({...l,events:{...l.events,...a}})),setSize:(a,l,v,y,w)=>{const S=s().camera,x={width:a,height:l,top:y||0,left:w||0,updateStyle:v};_(R=>({size:x,viewport:{...R.viewport,...c(S,n,x)}}))},setDpr:a=>_(l=>{const v=Be(a);return{viewport:{...l.viewport,dpr:v,initialDpr:l.viewport.initialDpr||v}}}),setFrameloop:(a="always")=>{const l=s().clock;l.stop(),l.elapsedTime=0,a!=="never"&&(l.start(),l.elapsedTime=0),_(()=>({frameloop:a}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:T.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(a,l,v)=>{const y=s().internal;return y.priority=y.priority+(l>0?1:0),y.subscribers.push({ref:a,priority:l,store:v}),y.subscribers=y.subscribers.sort((w,S)=>w.priority-S.priority),()=>{const w=s().internal;w!=null&&w.subscribers&&(w.priority=w.priority-(l>0?1:0),w.subscribers=w.subscribers.filter(S=>S.ref!==a))}}}}}),i=o.getState();let u=i.size,p=i.viewport.dpr,E=i.camera;return o.subscribe(()=>{const{camera:_,size:s,viewport:m,gl:n,set:r}=o.getState();if(s!==u||m.dpr!==p){var c;u=s,p=m.dpr,At(_,s),n.setPixelRatio(m.dpr);const f=(c=s.updateStyle)!=null?c:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(s.width,s.height,f)}_!==E&&(E=_,r(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(_)}})))}),o.subscribe(_=>e(_)),o};let ie,zt=new Set,Bt=new Set,Ht=new Set;function ve(e,t){if(e.size)for(const{callback:o}of e.values())o(t)}function Q(e,t){switch(e){case"before":return ve(zt,t);case"after":return ve(Bt,t);case"tail":return ve(Ht,t)}}let me,he;function ge(e,t,o){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),me=t.internal.subscribers,ie=0;ie<me.length;ie++)he=me[ie],he.ref.current(he.store.getState(),i,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Nt(e){let t=!1,o,i,u;function p(s){i=requestAnimationFrame(p),t=!0,o=0,Q("before",s);for(const n of e.values()){var m;u=n.store.getState(),u.internal.active&&(u.frameloop==="always"||u.internal.frames>0)&&!((m=u.gl.xr)!=null&&m.isPresenting)&&(o+=ge(s,u))}if(Q("after",s),o===0)return Q("tail",s),t=!1,cancelAnimationFrame(i)}function E(s,m=1){var n;if(!s)return e.forEach(r=>E(r.store.getState()),m);(n=s.gl.xr)!=null&&n.isPresenting||!s.internal.active||s.frameloop==="never"||(s.internal.frames=Math.min(60,s.internal.frames+m),t||(t=!0,requestAnimationFrame(p)))}function _(s,m=!0,n,r){if(m&&Q("before",s),n)ge(s,n,r);else for(const c of e.values())ge(s,c.store.getState());m&&Q("after",s)}return{loop:p,invalidate:E,advance:_}}function Ge(){const e=T.useContext(Ue);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function q(e=o=>o,t){return Ge()(e,t)}function qt(e,t=0){const o=Ge(),i=o.getState().internal.subscribe,u=Ie(e);return te(()=>i(u,t,o),[t,i,o]),null}function $e(e,t){return function(o,...i){const u=new o;return e&&e(u),Promise.all(i.map(p=>new Promise((E,_)=>u.load(p,s=>{s.scene&&Object.assign(s,Rt(s.scene)),E(s)},t,s=>_(new Error(`Could not load ${p}: ${s.message})`))))))}}function ne(e,t,o,i){const u=Array.isArray(t)?t:[t],p=Ct($e(o,i),[e,...u],{equal:D.equ});return Array.isArray(t)?p:p[0]}ne.preload=function(e,t,o){const i=Array.isArray(t)?t:[t];return Et($e(o),[e,...i])};ne.clear=function(e,t){const o=Array.isArray(t)?t:[t];return Pt([e,...o])};const Y=new Map,{invalidate:je,advance:Re}=Nt(Y),{reconciler:le,applyProps:Z}=Ot(Y,Dt),$={objects:"shallow",strict:!1},Ut=(e,t)=>{const o=typeof e=="function"?e(t):e;return qe(o)?o:new ot({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Gt(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:o,height:i,top:u,left:p}=e.parentElement.getBoundingClientRect();return{width:o,height:i,top:u,left:p}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function $t(e){const t=Y.get(e),o=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const u=typeof reportError=="function"?reportError:console.error,p=i||Ft(je,Re),E=o||le.createContainer(p,X.ConcurrentRoot,null,!1,null,"",u,null);t||Y.set(e,{fiber:E,store:p});let _,s=!1,m;return{configure(n={}){let{gl:r,size:c,scene:f,events:d,onCreated:b,shadows:h=!1,linear:a=!1,flat:l=!1,legacy:v=!1,orthographic:y=!1,frameloop:w="always",dpr:S=[1,2],performance:x,raycaster:R,camera:I,onPointerMissed:A}=n,C=p.getState(),j=C.gl;C.gl||C.set({gl:j=Ut(r,e)});let F=C.raycaster;F||C.set({raycaster:F=new tt});const{params:U,...G}=R||{};if(D.equ(G,F,$)||Z(F,{...G}),D.equ(U,F.params,$)||Z(F,{params:{...F.params,...U}}),!C.camera||C.camera===m&&!D.equ(m,I,$)){m=I;const O=I instanceof it,k=O?I:y?new nt(0,0,0,0,.1,1e3):new rt(75,0,.1,1e3);O||(k.position.z=5,I&&Z(k,I),!C.camera&&!(I!=null&&I.rotation)&&k.lookAt(0,0,0)),C.set({camera:k})}if(!C.scene){let O;f instanceof Pe?O=f:(O=new Pe,f&&Z(O,f)),C.set({scene:W(O)})}if(!C.xr){const O=(L,K)=>{const H=p.getState();H.frameloop!=="never"&&Re(L,!0,H,K)},k=()=>{const L=p.getState();L.gl.xr.enabled=L.gl.xr.isPresenting,L.gl.xr.setAnimationLoop(L.gl.xr.isPresenting?O:null),L.gl.xr.isPresenting||je(L)},B={connect(){const L=p.getState().gl;L.xr.addEventListener("sessionstart",k),L.xr.addEventListener("sessionend",k)},disconnect(){const L=p.getState().gl;L.xr.removeEventListener("sessionstart",k),L.xr.removeEventListener("sessionend",k)}};j.xr&&B.connect(),C.set({xr:B})}if(j.shadowMap){const O=j.shadowMap.enabled,k=j.shadowMap.type;if(j.shadowMap.enabled=!!h,D.boo(h))j.shadowMap.type=fe;else if(D.str(h)){var N;const B={basic:st,percentage:at,soft:fe,variance:lt};j.shadowMap.type=(N=B[h])!=null?N:fe}else D.obj(h)&&Object.assign(j.shadowMap,h);(O!==j.shadowMap.enabled||k!==j.shadowMap.type)&&(j.shadowMap.needsUpdate=!0)}const z=De();z&&("enabled"in z?z.enabled=!v:"legacyMode"in z&&(z.legacyMode=v));const g=a?ct:xe,M=l?ft:ut;j.outputEncoding!==g&&(j.outputEncoding=g),j.toneMapping!==M&&(j.toneMapping=M),C.legacy!==v&&C.set(()=>({legacy:v})),C.linear!==a&&C.set(()=>({linear:a})),C.flat!==l&&C.set(()=>({flat:l})),r&&!D.fun(r)&&!qe(r)&&!D.equ(r,j,$)&&Z(j,r),d&&!C.events.handlers&&C.set({events:d(p)});const P=Gt(e,c);return D.equ(P,C.size,$)||C.setSize(P.width,P.height,P.updateStyle,P.top,P.left),S&&C.viewport.dpr!==Be(S)&&C.setDpr(S),C.frameloop!==w&&C.setFrameloop(w),C.onPointerMissed||C.set({onPointerMissed:A}),x&&!D.equ(x,C.performance,$)&&C.set(O=>({performance:{...O.performance,...x}})),_=b,s=!0,this},render(n){return s||this.configure(),le.updateContainer(T.createElement(Wt,{store:p,children:n,onCreated:_,rootElement:e}),E,null,()=>{}),p},unmount(){We(e)}}}function Wt({store:e,children:t,onCreated:o,rootElement:i}){return te(()=>{const u=e.getState();u.set(p=>({internal:{...p.internal,active:!0}})),o&&o(u),e.getState().events.connected||u.events.connect==null||u.events.connect(i)},[]),T.createElement(Ue.Provider,{value:e},t)}function We(e,t){const o=Y.get(e),i=o==null?void 0:o.fiber;if(i){const u=o==null?void 0:o.store.getState();u&&(u.internal.active=!1),le.updateContainer(null,i,null,()=>{u&&setTimeout(()=>{try{var p,E,_,s;u.events.disconnect==null||u.events.disconnect(),(p=u.gl)==null||(E=p.renderLists)==null||E.dispose==null||E.dispose(),(_=u.gl)==null||_.forceContextLoss==null||_.forceContextLoss(),(s=u.gl)!=null&&s.xr&&u.xr.disconnect(),xt(u),Y.delete(e),t&&t(e)}catch{}},500)})}}le.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:T.version});const _e={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Vt(e){const{handlePointer:t}=It(e);return{priority:1,enabled:!0,compute(o,i,u){i.pointer.set(o.offsetX/i.size.width*2-1,-(o.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(_e).reduce((o,i)=>({...o,[i]:t(i)}),{}),update:()=>{var o;const{events:i,internal:u}=e.getState();(o=u.lastEvent)!=null&&o.current&&i.handlers&&i.handlers.onPointerMove(u.lastEvent.current)},connect:o=>{var i;const{set:u,events:p}=e.getState();p.disconnect==null||p.disconnect(),u(E=>({events:{...E.events,connected:o}})),Object.entries((i=p.handlers)!=null?i:[]).forEach(([E,_])=>{const[s,m]=_e[E];o.addEventListener(s,_,{passive:m})})},disconnect:()=>{const{set:o,events:i}=e.getState();if(i.connected){var u;Object.entries((u=i.handlers)!=null?u:[]).forEach(([p,E])=>{if(i&&i.connected instanceof HTMLElement){const[_]=_e[p];i.connected.removeEventListener(_,E)}}),o(p=>({events:{...p.events,connected:void 0}}))}}}}const Xt=T.forwardRef(function({children:t,fallback:o,resize:i,style:u,gl:p,events:E=Vt,eventSource:_,eventPrefix:s,shadows:m,linear:n,flat:r,legacy:c,orthographic:f,frameloop:d,dpr:b,performance:h,raycaster:a,camera:l,onPointerMissed:v,onCreated:y,...w},S){T.useMemo(()=>St(vt),[]);const x=gt(),[R,I]=mt({scroll:!0,debounce:{scroll:50,resize:0},...i}),A=T.useRef(null),C=T.useRef(null);T.useImperativeHandle(S,()=>A.current);const j=Ie(v),[F,U]=T.useState(!1),[G,N]=T.useState(!1);if(F)throw F;if(G)throw G;const z=T.useRef(null);te(()=>{const M=A.current;I.width>0&&I.height>0&&M&&(z.current||(z.current=$t(M)),z.current.configure({gl:p,events:E,shadows:m,linear:n,flat:r,legacy:c,orthographic:f,frameloop:d,dpr:b,performance:h,raycaster:a,camera:l,size:I,onPointerMissed:(...P)=>j.current==null?void 0:j.current(...P),onCreated:P=>{P.events.connect==null||P.events.connect(_?kt(_)?_.current:_:C.current),s&&P.setEvents({compute:(O,k)=>{const B=O[s+"X"],L=O[s+"Y"];k.pointer.set(B/k.size.width*2-1,-(L/k.size.height)*2+1),k.raycaster.setFromCamera(k.pointer,k.camera)}}),y==null||y(P)}}),z.current.render(T.createElement(x,null,T.createElement(Fe,{set:N},T.createElement(T.Suspense,{fallback:T.createElement(Tt,{set:U})},t)))))}),T.useEffect(()=>{const M=A.current;if(M)return()=>We(M)},[]);const g=_?"none":"auto";return T.createElement("div",we({ref:C,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:g,...u}},w),T.createElement("div",{ref:R,style:{width:"100%",height:"100%"}},T.createElement("canvas",{ref:A,style:{display:"block"}},o)))}),dn=T.forwardRef(function(t,o){return T.createElement(ht,null,T.createElement(Xt,we({},t,{ref:o})))});let se=null;function Ve(e,t,o){return i=>{o&&o(i),e&&(se||(se=new yt),se.setDecoderPath(typeof e=="string"?e:"https://www.gstatic.com/draco/versioned/decoders/1.5.5/"),i.setDRACOLoader(se)),t&&i.setMeshoptDecoder(typeof ue=="function"?ue():ue)}}function Xe(e,t=!0,o=!0,i){return ne(Ce,e,Ve(t,o,i))}Xe.preload=(e,t=!0,o=!0,i)=>ne.preload(Ce,e,Ve(t,o,i));Xe.clear=e=>ne.clear(Ce,e);const pn=T.forwardRef(({makeDefault:e,camera:t,regress:o,domElement:i,enableDamping:u=!0,onChange:p,onStart:E,onEnd:_,...s},m)=>{const n=q(w=>w.invalidate),r=q(w=>w.camera),c=q(w=>w.gl),f=q(w=>w.events),d=q(w=>w.setEvents),b=q(w=>w.set),h=q(w=>w.get),a=q(w=>w.performance),l=t||r,v=i||f.connected||c.domElement,y=T.useMemo(()=>new bt(l),[l]);return qt(()=>{y.enabled&&y.update()},-1),T.useEffect(()=>(y.connect(v),()=>void y.dispose()),[v,o,y,n]),T.useEffect(()=>{const w=R=>{n(),o&&a.regress(),p&&p(R)},S=R=>{E&&E(R)},x=R=>{_&&_(R)};return y.addEventListener("change",w),y.addEventListener("start",S),y.addEventListener("end",x),()=>{y.removeEventListener("start",S),y.removeEventListener("end",x),y.removeEventListener("change",w)}},[p,E,_,y,n,d]),T.useEffect(()=>{if(e){const w=h().controls;return b({controls:y}),()=>b({controls:w})}},[e,y]),T.createElement("primitive",we({ref:m,object:y,enableDamping:u},s))});export{dn as C,pn as O,Xe as u};
